import{aG as x,ar as c,aH as C,r as f,aI as w,aJ as S,aK as y,aL as U,aM as M,j as a,am as D,aw as I,ax as B,ay as T,aN as O,aO as R,ab as N,aP as _,a1 as v,a2 as m}from"./index-BInzX4Ab.js";import{G as P}from"./index-BISRb33a.js";import{default as oe}from"./AudioWaveform-CmKi99_P.js";import"./react-vendor-DoC2WAmd.js";import"./waveform-DboQP8RY.js";import"./image_not_available-BKPJ_btM.js";function $(e){return P({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"},child:[]}]})(e)}const G=["audio/mpeg","audio/wav","audio/ogg","audio/webm","audio/aac","audio/x-m4a"],H=["mp3","wav","ogg","m4a","aac"],W=10*1024*1024,V=e=>`${(e/1048576).toFixed(2)} MB`;async function X(e,s=W){var t;if(e.size>s)return x(c.lengthMax(V(s)));if(e.size===0)return x(c.emty);if(!G.includes(e.type))return x(c.unsupportedFormat);const i=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();return!i||!H.includes(i)?x(c.fileExtension):C(void 0)}function q(e,s="Invariant failed"){if(!e)throw new Error(s)}function z(e){const[s,i]=f.useState(null);return f.useEffect(()=>{if(!e){i(null);return}const t=URL.createObjectURL(e);return i(t),()=>{URL.revokeObjectURL(t)}},[e]),s}function Z({track:e,onOpenChange:s,onUploaded:i}){const{mutateAsync:t,isPending:p}=w(),{mutate:n}=S(),u=f.useRef(null),{file:l,setFile:o,error:j,setError:r}=y(),g=U(M),h=z(l);return f.useEffect(()=>{o(null),r(null)},[e.id]),{fileRef:u,selectedFile:l,selectedUrl:h,error:j,handleChoose:()=>{var d;return(d=u.current)==null?void 0:d.click()},handleChange:async d=>{var F;const L=((F=d.target.files)==null?void 0:F[0])||null;if(!L)return;(await X(L)).match(()=>{r(null),o(L)},b=>{r(b),o(null)})},handleSave:async()=>{q(l,c.requiredFile);try{await t({id:e.id,file:l}),s(!1),i==null||i()}catch(d){console.error(c.errorUploading,d)}},handleRemove:()=>{n({id:e.id}),g(e.id),s(!1)},loading:p,clear:()=>{o(null),r(null)}}}function te({track:e,open:s,onOpenChange:i,onUploaded:t}){const{fileRef:p,selectedFile:n,selectedUrl:u,error:l,handleChoose:o,handleChange:j,handleSave:r,handleRemove:g,loading:h,clear:A}=Z({track:e,onOpenChange:i,onUploaded:t});return f.useEffect(()=>{s&&requestAnimationFrame(()=>{const E=document.activeElement;E&&E.blur()})},[s]),a.jsx(D,{open:s,onOpenChange:i,children:a.jsxs(I,{children:[a.jsxs(B,{children:[a.jsxs(T,{children:["Audio for “",e.title,"”"]}),a.jsx(O,{children:e.audioFile?R.replaceOrRemove:R.selectToUpload})]}),a.jsx("input",{ref:p,type:"file",accept:"audio/*",className:"hidden",onChange:j}),l&&a.jsx("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:l}),a.jsx("div",{className:"mt-4 space-y-4",children:n&&u?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm mb-2",children:"Preview:"}),a.jsx(N,{id:"preview",previewUrl:u}),a.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.jsx("span",{className:"truncate text-sm text-balance",children:n.name}),a.jsx("button",{onClick:A,className:"text-gray-500 hover:text-gray-700","data-testid":`clear-selected-file-${e.id}`,children:a.jsx($,{className:"h-4 w-4"})})]})]}):e.audioFile?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm mb-2",children:"Current file:"}),a.jsx(N,{id:e.id,audioFile:e.audioFile})]}):null}),a.jsxs(_,{className:"flex justify-between mt-4",children:[e.audioFile&&!n&&a.jsx(v,{variant:"destructive",onClick:g,"data-testid":`delete-audio-${e.id}`,children:m.REMOVE_FILE}),a.jsxs("div",{className:"flex gap-2 ml-auto",children:[a.jsx(v,{variant:"outline",onClick:()=>i(!1),children:m.CANCEL}),a.jsx(v,{onClick:o,"data-testid":`choose-file-${e.id}`,children:m.CHOOSE_FILE}),a.jsx(v,{disabled:!n||h,onClick:r,"data-testid":`save-audio-${e.id}`,children:h?m.SAVING:m.SAVE})]})]})]})})}export{te as AudioUploadModal,N as TrackWaveform,oe as Waveform};
